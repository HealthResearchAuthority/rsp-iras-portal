@using Rsp.Portal.Application.Constants
@using Rsp.Portal.Application.DTOs.Responses.CmsContent
@model Rsp.Portal.Web.Features.SponsorWorkspace.MyOrganisations.Models.SponsorMyOrganisationUsersViewModel

@{
	ViewBag.Title = (string?)ViewData[PageContentElements.MetaTitle];

    var pageContentData = (Dictionary<string, MixedContentPageItem?>?)ViewData[PageContentElements.PageContent];
    var pageContent = pageContentData != null
        ? pageContentData
        : new Dictionary<string, MixedContentPageItem?>();

	var headline = pageContent.GetValueOrDefault("SponsorWorkspace.MyOrganisationUsersCheckAndConfirm.Title", null);
	var body = pageContent.GetValueOrDefault("SponsorWorkspace.MyOrganisationUsersCheckAndConfirm.Body", null);
	var description = pageContent.GetValueOrDefault("SponsorWorkspace.MyOrganisationUsersCheckAndConfirm.Description", null);

    var backRoute = "";
}

@section BackNavigation {
    @{
        backRoute = string.Equals(Model.Role, Roles.Sponsor, StringComparison.CurrentCultureIgnoreCase) ? "sws:myorganisationusersadduserpermission" : "sws:myorganisationusersadduserrole";
    }
    <partial name="_BackNavigation" model="@(backRoute, "Back", new Dictionary<string, string> { { "RtsId", Model.RtsId }, { "UserId", Model.UserId }, { "Role", Model.Role }, { "CanAuthorise", Model.CanAuthorise.ToString() } })" />
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column">
        <div class="govuk-label">
            @Html.Raw(headline?.Value)
        </div>
        <h1 class="govuk-heading-l"> @Html.Raw(body?.Value)</h1>
        <label class="govuk-label">
            @Html.Raw(description?.Value) @Model.Name.
        </label>
        <br/>
        <form method="get"
              class="govuk-form-group">
            <table class="govuk-table">
                <thead>
                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <tr class="govuk-table__row">
                    <td class="govuk-table__cell">
                        <b>Email</b>
                    </td>
                    <td class="govuk-table__cell">
                        @Model.Email
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        @{
                            await RenderEditLink("sws:myorganisationusersadduser");
                        }
                    </td>
                </tr>

                <tr class="govuk-table__row">
                    <td class="govuk-table__cell">
                        <b>Role</b>
                    </td>
                        @{
                            var role = Model.Role;

                            role = string.IsNullOrWhiteSpace(role)
                                ? role
                                : char.ToUpper(role[0]) +
                                  role[1..]
                                      .Replace("_", " ")
                                      .ToLowerInvariant();
                        }
                        <td class="govuk-table__cell">
                            @role
                        </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        @{
                            await RenderEditLink("sws:myorganisationusersadduserrole");
                        }
                    </td>
                </tr>

                <tr class="govuk-table__row">
                    <td class="govuk-table__cell">
                        <b>Authoriser</b>
                    </td>
                    <td class="govuk-table__cell">
                        @(Model.CanAuthorise ? "Yes" : "No")
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        @{
                            await RenderEditLink("sws:myorganisationusersadduserpermission");
                        }
                    </td>
                </tr>
                </tbody>
            </table>
            
			<input type="hidden" name="rtsId" value="@Model.RtsId" />
			<input type="hidden" name="userId" value="@Model.UserId" />
            <input type="hidden" name="role" value="@Model.Role" />
            <input type="hidden" name="CanAuthorise" value="@(Model.CanAuthorise ? "true" : "false")" />

            @{
                ViewBag.Style = "govuk-button govuk-button--primary";
            }
            <partial name="_SubmitButton"
					 model="@("sws:myorganisationusersconfirmadduser", "Confirm", new Dictionary<string, string>())" />

            @{
                ViewBag.Style = "ms-3 govuk-button govuk-button--secondary";
            }

			<partial name="_SubmitButton" model="@("sws:myorganisationusers", "Cancel", new Dictionary<string, string> { { "RtsId", Model.RtsId }})" />

        </form>
    </div>
</div>

@{
    async Task RenderEditLink(string route)
    {
        <a class="govuk-link" asp-route=@route asp-route-rtsId="@Model.RtsId"
           asp-route-userId="@Model.UserId"
           asp-route-role="@Model.Role"
           asp-route-canAuthorise="@Model.CanAuthorise">
            Change
        </a>
    }
}