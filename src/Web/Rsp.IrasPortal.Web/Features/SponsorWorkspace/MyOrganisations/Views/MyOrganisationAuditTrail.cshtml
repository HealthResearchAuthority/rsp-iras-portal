@using Rsp.Portal.Application.Constants
@using Rsp.Portal.Application.DTOs.Responses
@using Rsp.Portal.Application.DTOs.Responses.CmsContent
@using Rsp.Portal.Web.Features.SponsorWorkspace.MyOrganisations.Models
@model SponsorMyOrganisationAuditViewModel

@section Breadcrumb {
	@await Html.PartialAsync("_Breadcrumb", new List<(string, string?)>
	{
		("Sponsor workspace", Url.RouteUrl("sws:sponsorworkspace")),
		("My organisations", Url.RouteUrl("sws:myorganisations"))
	})
}

@{
	var sortableHeaders = new[]
		{
		new { Field = nameof(SponsorOrganisationAuditTrailDto.DateTimeStamp), Label = "Date" },
		new { Field = nameof(SponsorOrganisationAuditTrailDto.Description), Label = "Event description" },
		new { Field = nameof(SponsorOrganisationAuditTrailDto.User), Label = "Username" }
		};

	var tableId = "sponsorOrganisationAuditTable";

	var errorSummaryTitle = "There is a problem";
	ViewBag.Title = (string?)ViewData[PageContentElements.MetaTitle];

	var pageContentData = (Dictionary<string, MixedContentPageItem?>?)ViewData[PageContentElements.PageContent];
	var pageContent = pageContentData != null
		? pageContentData
		: new Dictionary<string, MixedContentPageItem?>();

	var headline = pageContent.GetValueOrDefault("SponsorWorkspace.MyOrganisationAuditTrail.Title", null);
}

<div class="govuk-grid-row">
	<div class="govuk-grid-column-two-thirds">
		<div class="govuk-caption-l">
			@Html.Raw(headline?.Value)
		</div>
		<h1 class="govuk-heading-l">@Model.Name</h1>
	</div>
</div>

<partial name="_NavigationTabPartial" model="@Model" view-data="@ViewData" />

<br />
<h2 class="govuk-heading-l">
	Audit history
</h2>
<div class="govuk-grid-row">
	<div class="govuk-grid-column-full">
		<div class="govuk-table-wrapper">
			<table class="govuk-table govuk-table-users">
				<thead>
					<tr>
						@foreach (var header in sortableHeaders)
						{
							var sortableHeaderModel = new SortableHeaderModel
							{
								FieldName = header.Field,
								DisplayText = header.Label,
								CurrentSortField = Model.Pagination?.SortField,
								CurrentSortDirection = Model.Pagination?.SortDirection,
								TableId = tableId,
								AdditionalParameters = new Dictionary<string, string>
									{
										{ "rtsId", Model.RtsId },
									}
							};

							<th scope="col" class="govuk-table__header govuk-table__header-sortable">
								<partial name="_SortableHeaderButton" model="@sortableHeaderModel" />
							</th>
						}
					</tr>
				</thead>
				<tbody>
					@foreach (var record in Model.AuditTrails)
					{
						<tr class="govuk-table__row">
							<td class="govuk-table__cell">@record.DateTimeStamp.ToString("dd MMM yyyy") at @record.DateTimeStamp.ToString("HH:mm")</td>
							<td class="govuk-table__cell">@record.Description</td>
							<td class="govuk-table__cell line-break-anywhere">@record.User</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
		<partial name="_Pagination" model="@Model.Pagination" />
	</div>
</div>
