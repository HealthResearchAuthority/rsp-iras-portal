@using Rsp.Gds.Component.Models
@using Rsp.Portal.Application.Constants
@using Rsp.Portal.Application.DTOs.Responses.CmsContent
@using Rsp.Portal.Domain.AccessControl
@using Rsp.Portal.Web.Features.Modifications.Models
@model Rsp.Portal.Web.Features.SponsorWorkspace.Authorisation.Models.AuthoriseModificationsOutcomeViewModel

@{
    ViewBag.Title = (string?)ViewData[PageContentElements.MetaTitle];    

    ViewBag.SponsorOrganisationUserId = Model.SponsorOrganisationUserId;
    ViewBag.RtsId = Model.RtsId;

    var pageContentData = (Dictionary<string, MixedContentPageItem?>?)ViewData[PageContentElements.PageContent];
    var pageContent = pageContentData ?? new Dictionary<string, MixedContentPageItem?>();

    var headline = pageContent.GetValueOrDefault("SponsorWorkspace.RequestRevisions.Title", null);
    var description = pageContent.GetValueOrDefault("SponsorWorkspace.RequestRevisions.Description", null);      
}

@section BackNavigation {
    <partial name="_BackNavigation" model="@(
                  (
                     "sws:checkandauthorise",
                     "Back",
                     new Dictionary<string, string> {
                        { "projectRecordId", Model.ProjectRecordId },
                        { "irasId", Model.IrasId.ToString() },
                        { "shortTitle", Model.ShortTitle },
                        { "projectModificationId", Model.ProjectModificationId.ToString() },
                        { "sponsorOrganisationUserId", Model.SponsorOrganisationUserId.ToString() },
                        { "rtsId", Model.RtsId }
                     }
                 ))" />
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l">
            @Html.Raw(headline?.Value)
        </h1>

        <partial name="_ValidationSummary" model="@(ViewData.ModelState, "There is a problem")" />

        <partial name="~/Features/Modifications/Shared/_ProjectModificationSummary.cshtml"
        model="Model"
        view-data="ViewData" />
    </div>
</div>

<form asp-route="sws:sendrequestrevisions" method="post">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">            

            @Html.Raw(description?.Value)

            <div class="govuk-form-group govuk-character-count"
                 data-module="govuk-character-count"
                 data-maxlength="1000"
                 error-class-for="RevisionDescription">

                @Html.ValidationMessageFor(model => model.RevisionDescription, "", new { @class = "govuk-error-message" })
                <textarea asp-for="RevisionDescription"
                          name="RevisionDescription"
                          class="govuk-textarea govuk-js-character-count"
                          rows="5"
                          aria-describedby="with-hint-info with-hint-hint">
                    </textarea>
                <noscript>
                    <div id="RevisionDescription-info"
                         class="govuk-hint govuk-character-count__message">
                        <p class='govuk-hint'>You can enter up to 1000 characters</p>
                    </div>
                </noscript>

                <div id="RevisionDescription-info"
                     aria-hidden="true"
                     class="govuk-hint govuk-character-count__message">
                </div>
            </div>          

            <input type="hidden" name="ProjectRecordId" value="@Model.ProjectRecordId" />
            <input type="hidden" name="IrasId" value="@Model.IrasId" />
            <input type="hidden" name="ShortTitle" value="@Model.ShortTitle" />
            <input type="hidden" name="ModificationId" value="@Model.ModificationId" />
            <input type="hidden" name="SponsorOrganisationUserId" value="@Model.SponsorOrganisationUserId" />
            <input type="hidden" name="ProjectModificationId" value="@Model.ProjectModificationId" />
            <input type="hidden" name="ModificationIdentifier" value="@Model.ModificationIdentifier" />
            <input type="hidden" name="Outcome" value="@Model.Outcome" />    
            <input type="hidden" name="RtsId" value="@Model.RtsId" />
            
            <button type="submit" class="govuk-button" data-module="govuk-button">
                Send request
            </button>
        </div>
    </div>
</form>