@using Rsp.Gds.Component.Models
@using Rsp.Portal.Application.Constants
@using Rsp.Portal.Application.DTOs.Responses.CmsContent
@using Rsp.Portal.Domain.AccessControl
@using Rsp.Portal.Web.Features.Modifications.Models
@model Rsp.Portal.Web.Features.SponsorWorkspace.Authorisation.Models.AuthoriseModificationsOutcomeViewModel

@{
	ViewBag.Title = (string?)ViewData[PageContentElements.MetaTitle];    

    ViewBag.SponsorOrganisationUserId = Model.SponsorOrganisationUserId;    

    var pageContentData = (Dictionary<string, MixedContentPageItem?>?)ViewData[PageContentElements.PageContent];
    var pageContent = pageContentData ?? new Dictionary<string, MixedContentPageItem?>();

    var headline = pageContent.GetValueOrDefault("SponsorWorkspace.RequestRevisions.Title", null);
    var description = pageContent.GetValueOrDefault("SponsorWorkspace.RequestRevisions.Description", null);      
}

@section BackNavigation {
    <partial name="_BackNavigation" model="@(
                  (
                     "sws:checkandauthorise",
                     "Back",
                     new Dictionary<string, string> {
                        { "projectRecordId", Model.ProjectRecordId },
                        { "irasId", Model.IrasId.ToString() },
                        { "shortTitle", Model.ShortTitle },
                        { "projectModificationId", Model.ProjectModificationId.ToString() },
                        { "sponsorOrganisationUserId", Model.SponsorOrganisationUserId.ToString() }
                     }
                 ))" />
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l">
            @Html.Raw(headline?.Value)
        </h1>

        <partial name="_ValidationSummary" model="@(ViewData.ModelState, "There is a problem")" />

        <partial name="~/Features/Modifications/Shared/_ProjectModificationSummary.cshtml"
        model="Model"
        view-data="ViewData" />
    </div>
</div>

<form asp-route="sws:sendrequestrevisions" method="post">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">            

            @Html.Raw(description?.Value)
            <rsp-gds-character-count-textarea asp-for="RevisionDescription"
                                              label-text=""
                                              word-count-error-for="_DescriptionExcessCharacterCount"
                                              rows="5"                                              
                                              width-class="govuk-!-width-full" />
            <p class='govuk-hint'>You can enter up to 1000 characters</p>

            <input type="hidden" name="ProjectRecordId" value="@Model.ProjectRecordId" />
            <input type="hidden" name="IrasId" value="@Model.IrasId" />
            <input type="hidden" name="ShortTitle" value="@Model.ShortTitle" />
            <input type="hidden" name="ModificationId" value="@Model.ModificationId" />
            <input type="hidden" name="SponsorOrganisationUserId" value="@Model.SponsorOrganisationUserId" />
            <input type="hidden" name="ProjectModificationId" value="@Model.ProjectModificationId" />
            <input type="hidden" name="ModificationIdentifier" value="@Model.ModificationIdentifier" />
            <input type="hidden" name="Outcome" value="@Model.Outcome" />            
            
            <button type="submit" class="govuk-button" data-module="govuk-button">
                Send request
            </button>
        </div>
    </div>
</form>