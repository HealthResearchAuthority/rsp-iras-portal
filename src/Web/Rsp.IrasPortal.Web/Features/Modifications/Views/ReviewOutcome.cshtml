@using Rsp.Portal.Application.Constants
@using Rsp.Portal.Web.Features.Modifications.Models
@model ReviewOutcomeViewModel
@{
    ViewBag.Title = "Review outcome";
}

<partial 
    name="_BackNavigation" 
    model="@(
        "pmc:reviewallchanges", 
        "Back", 
        new Dictionary<string, string>() { 
            { "projectRecordId", Model.ModificationDetails.ProjectRecordId },
            { "irasId", Model.ModificationDetails.IrasId },
            { "shortTitle", Model.ModificationDetails.ShortTitle! },
            { "projectModificationId", Model.ModificationDetails.ModificationId! }
        })" />

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <partial name="_ValidationSummary" model="@(ViewData.ModelState, "There is a problem")" />
    </div>
</div>

<partial name="_ReviewModification" model="@Model.ModificationDetails" />

<form asp-route="pmc:reviewoutcome" method="post">
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h2 class="govuk-heading-m">Leave a comment</h2>
            <span class="govuk-accordion__section-toggle govuk-!-margin-bottom-4" data-nosnippet="">
                <span class="govuk-accordion__section-toggle-focus">
                    <span class="govuk-accordion-nav__chevron govuk-accordion-nav__chevron--down"></span>
                    <span class="govuk-accordion__section-toggle-text">Show</span>
                </span>
            </span>
            <span class="govuk-accordion__section-toggle" data-nosnippet="">
                <span class="govuk-accordion__section-toggle-focus">
                    <span class="govuk-accordion-nav__chevron"></span>
                    <span class="govuk-accordion__section-toggle-text">Hide</span>
                </span>
            </span>

            <p class="govuk-hint">If you have any comments on this document add them to the box below. Comments are only visible to other reviewers and are not shared with the applicant.</p>
            <div class="govuk-form-group govuk-character-count"
                 data-module="govuk-character-count"
                 data-maxlength="300">
                <textarea 
                    asp-for="Comment"
                    name="Comment"
                    id="Comment"
                    class="govuk-textarea govuk-js-character-count"
                    rows="5"
                    aria-describedby="with-hint-info with-hint-hint">
                </textarea>
                <div id="Comment-info"
                     class="govuk-hint govuk-character-count__message">
                </div>
            </div>
        </div>
    </div>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h2 class="govuk-heading-m">Review outcome</h2>
            <div class="govuk-form-group">
                <fieldset class="govuk-fieldset">
                    <div class="govuk-radios" data-module="govuk-radios">
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="approved" type="radio" value="@ModificationStatus.Approved" asp-for="ReviewOutcome">
                            <label class="govuk-label govuk-radios__label" for="approved">
                                @ModificationStatus.Approved
                            </label>
                        </div>
                        <div class="govuk-radios__item">
                            <input class="govuk-radios__input" id="notApproved" type="radio" value="@ModificationStatus.NotApproved" asp-for="ReviewOutcome">
                            <label class="govuk-label govuk-radios__label" for="notApproved">
                                @ModificationStatus.NotApproved
                            </label>
                        </div>
                        <feature name="@FeatureFlags.RequestForInformation">
                            <div class="govuk-radios__item">
                                <input class="govuk-radios__input" id="rfi" type="radio" value="@ModificationStatus.RequestForInformation" asp-for="ReviewOutcome">
                                <label class="govuk-label govuk-radios__label" for="rfi">
                                    @ModificationStatus.RequestForInformation
                                </label>
                            </div>
                        </feature>
                    </div>
                </fieldset>
            </div>
            <div class="govuk-body">
                You'll be able to check the outcome again before sending to the applicant in the next steps
            </div>
            <div class="save-buttons">
                <button type="submit" class="govuk-button" data-module="govuk-button">
                    Save and continue
                </button>
                <button asp-route-saveForLater="true" type="submit" class="govuk-button govuk-button--secondary" data-module="govuk-button">
                    Save for later
                </button>
            </div>
        </div>
    </div>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const showBtn = document.querySelectorAll(".govuk-accordion__section-toggle")[0];
        const hideBtn = document.querySelectorAll(".govuk-accordion__section-toggle")[1];

        const textareaContainer = document.querySelector(".govuk-form-group.govuk-character-count");
        const hintText = document.querySelector(".govuk-hint:not(.govuk-character-count__message)");

        // Hide by default
        textareaContainer.style.display = "none";
        hintText.style.display = "none";
        hideBtn.style.display = "none";

        showBtn.addEventListener("click", () => {
            textareaContainer.style.display = "block";
            hintText.style.display = "block";
            showBtn.style.display = "none";
            hideBtn.style.display = "inline-block";
        });

        hideBtn.addEventListener("click", () => {
            textareaContainer.style.display = "none";
            hintText.style.display = "none";
            hideBtn.style.display = "none";
            showBtn.style.display = "inline-block";
        });
    });
</script>
