@using Rsp.Portal.Application.Constants
@using Rsp.Portal.Application.DTOs.Responses.CmsContent;

@section Breadcrumb {
    @await Html.PartialAsync("_Breadcrumb", new List<(string, string?)>())
}

@{
	ViewBag.Title = (string?)ViewData[PageContentElements.MetaTitle];
    var pageContentData = (Dictionary<string, MixedContentPageItem?>?)ViewData[PageContentElements.PageContent];
    var pageContent = pageContentData != null
        ? pageContentData
        : new Dictionary<string, MixedContentPageItem?>();

    var headline = pageContent.GetValueOrDefault("Approvals.Headline", null);
    var searchTitle = pageContent.GetValueOrDefault("Approvals.SearchTitle", null);
    var searchDescription = pageContent.GetValueOrDefault("Approvals.SearchDescription", null);
    var tasklistTitle = pageContent.GetValueOrDefault("Approvals.TasklistTitle", null);
    var tasklistDescription = pageContent.GetValueOrDefault("Approvals.TasklistDescription", null);
    var myTasklistTitle = pageContent.GetValueOrDefault("Approvals.MyTasklistTitle", null);
    var myTasklistDescription = pageContent.GetValueOrDefault("Approvals.MyTasklistDescription", null);

    // ✅ Override for team manager roles
    if (User.IsInRole(Roles.TeamManager))
    {
        tasklistTitle = new MixedContentPageItem { Value = "Team manager dashboard" };
        tasklistDescription = new MixedContentPageItem { Value = "Review and manage all tasks for your team." };
    }
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">@Html.Raw(headline?.Value)</h1>
        <partial name="_ActionItem" model="@((searchTitle?.Value, searchDescription?.Value, "recordsearch", new Dictionary<string, string>()))" />

        <partial role-in="@(new []{Roles.TeamManager, Roles.WorkflowCoordinator})"
                 name="_ActionItem"
                 model="@((tasklistTitle?.Value, tasklistDescription?.Value, "tasklist:index", new Dictionary<string, string>()))" />

        <partial role-is="@Roles.StudyWideReviewer"
                 name="_ActionItem"
                 model="@((myTasklistTitle?.Value, myTasklistDescription?.Value, "mytasklist:index", new Dictionary<string, string>()))" />
    </div>
</div>