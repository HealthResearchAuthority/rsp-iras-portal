@using System.Text.Json
@using Microsoft.AspNetCore.Mvc.ModelBinding
@using Microsoft.FeatureManagement
@using Rsp.IrasPortal.Application.Constants
@using System.Globalization
@model ModificationDetailsPageViewModel

@{
    // Title used in the validation error summary
    var errorSummaryTitle = "There is a problem";
    int changeIndex = 1;

    ViewData["Title"] = "Review all changes";
    ViewData["ReviewChanges"] = true;
    ViewData["Status"] = Model.Status;
}


@section BackNavigation {
    <form method="get">
        <partial name="_BackNavigation" model="@("pmc:sponsorreference", "Back", new Dictionary<string, string>())" />
    </form>
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">        
        <h1 class="govuk-heading-l">Review all changes</h1>
        <partial name="_ProjectModificationSummary" model="Model" viewData="ViewData" />
        <h2 class="govuk-heading-m">Overall modification ranking</h2>
        <div class="govuk-summary-card">
            <div class="govuk-summary-card__title-wrapper">
                <h2 class="govuk-summary-card__title">
                    Ranking
                </h2>
            </div>
            <div class="govuk-summary-card__content">
                <dl class="govuk-summary-list">
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Modification type
                        </dt>
                        <dd class="govuk-summary-list__value">
                            @Model.ModificationType
                        </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Category
                        </dt>
                        <dd class="govuk-summary-list__value">
                            @Model.Category
                        </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Review type
                        </dt>
                        <dd class="govuk-summary-list__value">
                            @Model.ReviewType
                        </dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>
</div>
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

        <h2 class="govuk-heading-m">Changes</h2>

        @foreach (var change in Model.ModificationChanges)
        {
            <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                    <h2 class="govuk-summary-card__title">
                        Change @changeIndex - @change.AreaOfChangeName                      
                    </h2>
                    <ul class="govuk-summary-card__actions">
                        <li class="govuk-summary-card__action">
                            <a class="govuk-link" asp-route="pmc:modificationchangesreview" asp-route-modificationChangeId="@change.ModificationChangeId">Change</a>
                        </li>
                        <li class="govuk-summary-card__action">
                            <a class="govuk-link" asp-route="pmc:confirmremovechange" asp-route-modificationChangeId="@change.ModificationChangeId">Remove</a>
                        </li>
                    </ul>
                </div>
                <div class="govuk-summary-card__content">
                    <dl class="govuk-summary-list">
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                @change.SpecificChangeName
                            </dt>
                            <dd class="govuk-summary-list__value">
                                @change.SpecificChangeAnswer
                            </dd>
                        </div>
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                Modification type
                            </dt>
                            <dd class="govuk-summary-list__value">
                                @change.ModificationType
                            </dd>
                        </div>
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                Category
                            </dt>
                            <dd class="govuk-summary-list__value">
                                @change.Category
                            </dd>
                        </div>
                        <div class="govuk-summary-list__row">
                            <dt class="govuk-summary-list__key">
                                Review type
                            </dt>
                            <dd class="govuk-summary-list__value">
                                @change.ReviewType
                            </dd>
                        </div>
                    </dl>
                </div>
            </div>
            changeIndex++;
        }
        <h2 class="govuk-heading-m">Sponsor details</h2>

        <div class="govuk-summary-card">
            <div class="govuk-summary-card__title-wrapper">
                <h2 class="govuk-summary-card__title">
                    Sponsor details
                </h2>
                <ul class="govuk-summary-card__actions">
                    <li class="govuk-summary-card__action">
                        <a class="govuk-link" asp-route="pmc:sponsorreference">Change</a>
                    </li>                    
                </ul>
            </div>
            <div class="govuk-summary-card__content">
                <dl class="govuk-summary-list">
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Sponsor reference (optional)
                        </dt>
                        <dd class="govuk-summary-list__value">
                            @Model.SponsorReference.SponsorModificationReference
                        </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Date (optional)
                        </dt>
                        <dd class="govuk-summary-list__value">
                            @Model.SponsorReference.SponsorModificationDate
                        </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                        <dt class="govuk-summary-list__key">
                            Brief summary of changes
                        </dt>
                        <dd class="govuk-summary-list__value">
                            @Model.SponsorReference.MainChangesDescription
                        </dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>
</div>
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-m">Now send to sponsor</h2>
        <p class="govuk-body">
            By sending this modification you are confirming that, to the best of your knowledge, the details you are providing are correct.
        </p>
        <form method="get">
            <div class="save-buttons">
                <input type="hidden" name="projectRecordId" value="@Model.ProjectRecordId" />
                <partial name="_SubmitButton" model="@("pmc:sendmodificationtosponsor", "Send modification to sponsor" , new Dictionary<string, string>())" />
                @{
                    ViewBag.Style = "govuk-button govuk-button--secondary";
                }
                <partial name="_SubmitButton" model="@("pov:postapproval", "Save for later", new Dictionary<string, string> { ["projectRecordId"] = Model.ProjectRecordId })" />
            </div>
        </form>
        <a class="govuk-link" asp-route="pmc:deletemodification">Delete modification</a>
    </div>
</div>